- report = @profile_user.report_with_name :basic

.container
    %h1
        Usage
        %span.capsule= report[:metadata][:time_difference].nil? ? "No Data" : "Past %.0f Hours" % [ report[:metadata][:time_difference] / 60 / 60 ]
    .content#chart_container
        #chart_div
            %table{:style => "width: 100%; height: 100%;"}
                %tr
                    %td.loading{:valign => :middle} Loading Chart Data...

:javascript
    // jQuery function, called when page load is complete
    $(document).ready(function() {
        // when the window is resized, redraw the graph to the new size
        $(window).bind("resize", function(event) {
            if ($('#chart_div').width() != $('#chart_div').children()[0].width)
                drawChart();
        });	

        $('#force_scrape').bind("click", function(event) {
            $('#force_scrape').attr('disabled', 'disabled');
            $('#force_scrape').attr('value', 'Forcing Scrape, Hold on...');
            $.ajax({
                type: "POST",
                url: "#{url('/force_scrape')}",
                success: function() { location.reload(); },
                error: function() { location.reload(); }
            });
        });
    });

    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(drawChart);
    function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Timestamp');
        data.addColumn('number', 'Total');
        #{report[:devices].map{ |device| "data.addColumn('number', '#{device[:display_name]}');" }.join ' '}
        data.addRows(#{ report[:rows].to_json });

        var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
        chart.draw(data, {
            legend: 'bottom', 
            areaOpacity: 1 / data.getNumberOfColumns(),
            hAxis: { textPosition: 'none', direction: -1 }, 
            vAxis: { minValue: 0, format: "#,### MB", textPosition: 'in' }, 
            chartArea: { top: 0, left: 0, height: "85%", width: "100%" }
        });
    }